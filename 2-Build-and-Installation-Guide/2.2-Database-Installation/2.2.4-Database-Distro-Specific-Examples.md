## Centos 6.5
### CentOS 6 postgres install
```
/etc/yum.repos.d/CentOS-Base.repo 
Add exclude=postgresql* for [base] and [updates] section

yum localinstall http://yum.postgresql.org/9.3/redhat/rhel-6-x86_64/pgdg-centos93-9.3-1.noarch.rpm
yum install postgresql93-server 

To remove 
rm -rf /var/lib/pgsql
yum remove postgresql93-server 
yum remove postgresql93-odbc
```

### InitDB and adding an orcmuser
```
service postgresql-9.3 initdb

/var/lib/pgsql/9.3/data/pg_hba.conf
(Must be before other entries) add: local all orcmuser trust  
if changing these after the postgres service is started
service postgresql-9.3 restart 
otherwise
service postgresql-9.3 start
Failed to start?  Check /var/lib/pgsql/9.3/pgstartup.log for details.  
Make sure an existing postgres process is not already running: /usr/pgsql-9.3/bin/postmaster -p 5432 ...
```

### Postgres user DB and DB user setup
```
su - postgres
dropdb orcmdb
dropuser orcmuser 
createuser orcmuser 
createdb --owner orcmuser orcmdb
```

### ORCM specific database creation script
```
The scripts can be found in the ORCM repo, in the following directory: orcm/build/contrib/database
psql --username=orcmuser --dbname=orcmdb -f orcmdb_psql.sql
```

### Client access setup
```
yum install postgresql93-odbc

rpm -ql postgresql93-odbc | grep psqlodbc.so
vi psql_odbc_driver.ini # Add psqlodbc.so with path
odbcinst -i -d -f psql_odbc_driver.ini
vi orcmdb_psql.ini # Add server localhost and psqlodbc.so with path
odbcinst -i -s -f orcmdb_psql.ini -h
odbcinst -s -q # List Data Source Names (DSNs)
vi /var/lib/pgsql/9.3/data/pg_hba.conf # Add "host all all 127.0.0.1/32 trust" and "host all all ::1/128 trust" for IPv4 and IPv6
service postgresql-9.3 restart

isql -v orcmdb_psql orcmuser # Test ODBC access to the DB.  Try select * from data_sample.
Look in /var/lib/pgsql/9.3/data/pg_log/postgresql-Tue.log for access logs to the DB
```

NOTE: for simplicity, these steps are configuring the authentication method for the database as "trust".  This is a good approach to start with to make it easier to get everything up and running.  However, once everything the basic setup is completed, it is highly recommended to configure a more secure authentication method.

### Run ORCM
```
orcmd --omca sensor heartbeat,coretemp --omca db_base_verbose 100 --omca db_odbc_dsn orcmdb_psql --omca db_odbc_user orcmuser:orc --omca db_odbc_table data_sample 
```

NOTE: because the "trust" authentication method was configured in the previous step, the password here is irrelevant.  However, after the basic setup is up and running, it is highly recommended to at least configure the "password" authentication method, in which case the correct password should be used here.

### Query the DB

First, initiate a _psql_ session: `psql -d orcmdb -U orcmuser [-W]`.

Querying sample data from RAS monitoring:
```
select data_sample.node_id,
       node.hostname,
       data_sample.data_item_id,
       data_item.name as data_item,
       data_item.data_type_id,
       data_sample.time_stamp,
       data_sample.value_int,
       data_sample.value_real,
       data_sample.value_str,
       data_sample.units
from data_sample
    inner join node on
        node.node_id = data_sample.node_id
    inner join data_item on
        data_item.data_item_id = data_sample.data_item_id
```

Deleting the data from RAS monitoring:
```
delete from data_sample;
```

Getting the number of sample data rows from RAS monitoring:
```
select count(*) from data_sample;
```

Querying node feature data (inventory):
```
select node_feature.node_id,
       node.hostname,
       node_feature.feature_id,
       feature.name as feature,
       node_feature.value_int,
       node_feature.value_real,
       node_feature.value_str,
       node_feature.units
from node_feature
    inner join node on
        node.node_id = node_feature.node_id
    inner join feature on
        feature.feature_id = node_feature.feature_id
```

### Enabling network access to the DB
```
/var/lib/pgsql/9.teuser3/data/postgresql.conf 
Add listen_addresses = '*' 
```

### Adding a password

Edit the following PostgreSQL configuration file:
```
/var/lib/pgsql/9.3/data/pg_hba.conf # Use "password" instead of "trust" 
```

From within a _psql_ session (logged in as orcmuser):
```
alter user orcmuser with password '<choose a password>'
;
```